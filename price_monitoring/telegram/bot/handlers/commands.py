import logging
from aiogram import Router, types
from aiogram.filters import CommandStart, Command
from aiogram.utils.keyboard import InlineKeyboardBuilder
from ..keyboards import create_main_menu_keyboard

logger = logging.getLogger(__name__)
router = Router()

@router.message(CommandStart())
async def handle_start(message: types.Message):

    if not message.from_user:

        logger.warning("Received /start command without user info.")

        return

    user_id = message.from_user.id

    logger.info(f"User {user_id} started the bot.")

    keyboard = create_main_menu_keyboard()

    welcome_message = (

        "üëã <b>–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ DMarket.</b>\n\n"

        "–Ø –ø–æ–º–æ–≥—É –≤–∞–º –Ω–∞–π—Ç–∏ –≤—ã–≥–æ–¥–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —Ç—Ä–µ–π–¥–∏–Ω–≥–∞ "

        "–Ω–∞ –ø–ª–æ—â–∞–¥–∫–µ DMarket. –í—ã –º–æ–∂–µ—Ç–µ:\n\n"

        "‚Ä¢ <b>–í—ã–±—Ä–∞—Ç—å —Ä–µ–∂–∏–º</b> - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø–æ–∏—Å–∫–∞\n"

        "‚Ä¢ <b>–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</b> - —É–∫–∞–∑–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω –ø—Ä–∏–±—ã–ª–∏\n"

        "‚Ä¢ <b>–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</b> - –Ω–∞–π—Ç–∏ –≤—ã–≥–æ–¥–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã\n"

        "‚Ä¢ <b>–í—ã–±—Ä–∞—Ç—å –∏–≥—Ä—ã</b> - –≤—ã–±—Ä–∞—Ç—å –∏–≥—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞\n\n"

        "<i>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—è –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ:</i>"

    )

    await message.answer(welcome_message, reply_markup=keyboard, parse_mode="HTML")



@router.message(Command("help"))
async def handle_help(message: types.Message):

    help_text = (

        "üìö <b>–ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞</b>\n\n"

        "<b>–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</b>\n\n"

        "üîç <b>–ü–æ–∏—Å–∫ –≤—ã–≥–æ–¥–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</b> - –±–æ—Ç –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–µ–¥–º–µ—Ç—ã –Ω–∞ DMarket "

        "—Å –Ω–∞–∏–ª—É—á—à–∏–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º —Ü–µ–Ω—ã –ø–æ–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏.\n\n"

        "üéÆ <b>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∏–≥—Ä—ã:</b>\n"

        "‚Ä¢ üî´ CS2 (Counter-Strike 2)\n"

        "‚Ä¢ üßô‚Äç‚ôÇÔ∏è Dota 2\n"

        "‚Ä¢ üé© Team Fortress 2 (TF2)\n"

        "‚Ä¢ üèùÔ∏è Rust\n\n"

        "<b>–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:</b>\n"

        "‚Ä¢ üí∏ <b>–†–∞–∑–≥–æ–Ω –±–∞–ª–∞–Ω—Å–∞</b> - –ø—Ä–µ–¥–º–µ—Ç—ã —Å –Ω–µ–±–æ–ª—å—à–æ–π –ø—Ä–∏–±—ã–ª—å—é ($1-5) –∏ –Ω–∏–∑–∫–∏–º —Ä–∏—Å–∫–æ–º\n"

        "‚Ä¢ üí∞ <b>–°—Ä–µ–¥–Ω–∏–π —Ç—Ä–µ–π–¥–µ—Ä</b> - –ø—Ä–µ–¥–º–µ—Ç—ã —Å–æ —Å—Ä–µ–¥–Ω–µ–π –ø—Ä–∏–±—ã–ª—å—é ($5-20)\n"

        "‚Ä¢ üìà <b>Trade Pro</b> - —Ä–µ–¥–∫–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã —Å –≤—ã—Å–æ–∫–æ–π –ø—Ä–∏–±—ã–ª—å—é ($20+)\n\n"

        "<b>–ö–æ–º–∞–Ω–¥—ã:</b>\n"

        "‚Ä¢ /start - –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –ø–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n"

        "‚Ä¢ /help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É\n\n"

        "<b>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:</b>\n"

        "1. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –≤–∞—à–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏\n"

        "2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è/–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å)\n"

        "3. –í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –∏–ª–∏ –≤—Å–µ –∏–≥—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞\n"

        "4. –ù–∞–∂–º–∏—Ç–µ '–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è' –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—ã–≥–æ–¥–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤\n"

        "5. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø–æ–º–æ—â—å—é –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n\n"

        "<i>–ë–æ—Ç –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–æ–≤—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.</i>"

    )

    builder = InlineKeyboardBuilder()

    builder.button(text="‚¨ÖÔ∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="back_to_main_menu")

    keyboard = builder.as_markup()

    await message.answer(help_text, reply_markup=keyboard, parse_mode="HTML") 