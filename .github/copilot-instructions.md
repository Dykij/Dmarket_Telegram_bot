# Инструкции для GitHub Copilot

Этот репозиторий содержит систему мониторинга цен на DMarket с интеграцией Telegram-бота для уведомлений и взаимодействия с пользователями.

## Обзор проекта

- **Язык программирования**: Python 3.11
- **Асинхронное программирование**: Asyncio
- **Управление зависимостями**: Poetry
- **Контейнеризация**: Docker, Docker Compose
- **Хранилище данных**: Redis (aioredis==2.0.0)
- **Очереди сообщений**: RabbitMQ (aio-pika==9.4.1)
- **Telegram-бот**: aiogram>=3.0.0
- **Тестирование**: Pytest с поддержкой asyncio (pytest>=8.3.5, pytest-asyncio>=0.26.0)
- **Контроль качества кода**: Black (line-length=100), Ruff, Pylint, Mypy, Pylance
- **Логирование**: json-logging>=1.3.0 для структурированного логирования
- **HTTP-клиент**: aiohttp>=3.9.0
- **Трассировка**: Zipkin (aiozipkin>=1.1.1)
- **Сериализация данных**: dataclasses-json>=0.5.7, marshmallow>=3.16.0

## Структура проекта

- **Парсер DMarket**: `price_monitoring/parsers/dmarket`
- **Обработка воркеров**: `price_monitoring/worker/processing`
- **Хранилище Redis**: `price_monitoring/storage`
- **Фреймворк валидации**: `price_monitoring/validation.py`
- **Система мониторинга**: `monitoring`
- **Тесты**: `tests/`

## Зависимости

### Основные библиотеки

- `aiogram>=3.0.0`: для создания Telegram-бота
- `aio-pika==9.4.1`: для асинхронного взаимодействия с RabbitMQ
- `aioredis==2.0.0`: для асинхронного взаимодействия с Redis
- `aioredis-lock>=0.1.0`: для блокировок в Redis
- `aiohttp>=3.9.0`: для асинхронных HTTP-запросов
- `aiohttp-socks>=0.7.1`: для поддержки SOCKS-прокси
- `asyncpg==0.29.0`: для взаимодействия с PostgreSQL (если используется)
- `dataclasses-json>=0.5.7`: для сериализации данных в dataclasses
- `marshmallow>=3.16.0`, `marshmallow-dataclass>=8.5.8`, `marshmallow-enum>=1.5.1`: для валидации и сериализации данных
- `aiozipkin>=1.1.1`: для трассировки запросов
- `orjson>=3.7.2`: для быстрой работы с JSON
- `PySocks>=1.7.1`: для поддержки прокси
- `random-user-agent>=1.0.1`: для генерации случайных User-Agent
- `json-logging>=1.3.0`: для структурированного логирования
- `PyYAML>=6.0`: для работы с YAML-конфигурациями
- `Brotli>=1.1.0`: для сжатия данных
- `uvloop>=0.16.0` (опционально): для повышения производительности на Linux

### Инструменты для разработки

- `pytest>=8.3.5`, `pytest-asyncio>=0.26.0`: для асинхронного тестирования
- `coverage>=7.8.0`: для измерения покрытия кода тестами
- `black>=25.1.0`: для форматирования кода (line-length=100)
- `ruff>=0.11.6`: для быстрого линтинга
- `pylint>=3.3.6`: для статического анализа кода (max-line-length=100)
- `mypy>=1.15.0`: для проверки типов (python_version=3.10)
- `fakeredis>=1.8.1`: для эмуляции Redis в тестах
- `aioresponses>=0.7.3`: для моков HTTP-запросов
- `freezegun>=1.2.1`: для управления временем в тестах
- `pre-commit>=4.2.0`: для автоматизации проверки кода перед коммитом
- `types-PyYAML`, `types-requests`, `types-redis`: для улучшения проверки типов
- `bandit>=1.8.3`, `safety>=3.3.1`: для анализа безопасности
- `flake8>=7.2.0`, `isort>=6.0.1`, `pycodestyle>=2.13.0`, `pydocstyle>=6.3.0`: для проверки стиля кода

## Правила кодирования

- Используйте асинхронное программирование с `asyncio` для операций ввода-вывода.
- Добавляйте аннотации типов для всех функций и методов (совместимость с `mypy`).
- Форматируйте код с помощью `black` (line-length=100) и проверяйте с `ruff`.
- Максимальная длина строки — 100 символов (настройки `black` и `pylint`).
- Пишите модульные тесты с использованием `pytest` и `pytest-asyncio`, размещайте их в `tests/`.
- Используйте `aiohttp` для HTTP-запросов, включая прокси через `aiohttp-socks`.
- Для работы с Redis используйте `aioredis==2.0.0`.
- Для Telegram-бота используйте `aiogram>=3.0.0`.
- Для очередей RabbitMQ используйте `aio-pika==9.4.1`.
- Сериализуйте данные с `dataclasses-json` или `marshmallow`, валидируйте с `marshmallow`.
- Избегайте использования запрещенных сообщений `pylint` (см. `pyproject.toml`).
- Хорошие имена переменных: `f`, `s`, `d`, `i`, `j`, `k`, `setUp`, `tearDown`.

## Конфигурация

- **Переменные окружения**: Задаются в `bot.dev.env`.
- **Прокси**: Настройки в `utils_mount/dmarket_proxies.txt`.
- **Poetry**: Все зависимости управляются через `pyproject.toml`.
- **Pytest**: Режим `asyncio_mode="auto"`, scope по умолчанию — `function`.
- **Coverage**: Исключены файлы: тесты, абстрактные классы, `__init__.py`, и указанные в `pyproject.toml`.
- **Mypy**: Игнорируются ошибки для модулей `common.*` и `price_monitoring.async_runner`.

## Дополнительные замечания

- Приложение контейнеризуется с помощью Docker и управляется через Docker Compose.
- Реализуйте обработку ошибок и структурированное логирование с `json-logging`.
- Используйте `aiozipkin` для трассировки запросов.
- Для повышения производительности на Linux активируйте `uvloop`.
- Учитывайте настройки инструментов из `pyproject.toml` при разработке.
- Тестируйте асинхронный код с `pytest-asyncio` и эмуляцией Redis через `fakeredis`.